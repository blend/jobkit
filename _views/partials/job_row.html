{{ define "partials/job_row" }}
<tr id="{{ .ViewModel.Name }}">
	<td> <!-- status -->
		{{ if .ViewModel.Current }}
			<div uk-tooltip="Job is currently running" uk-spinner="ration: 0.5"></div>
		{{ else if .ViewModel.Last }}
			{{ if .ViewModel.Last.State | eq "cancelled" }}
			<span class="uk-text-warning" uk-icon="warning" uk-tooltip="Last invocation cancelled"></span>
			{{ else if .ViewModel.Last.State | eq "failed" }}
			<span class="uk-text-danger" uk-icon="warning" uk-tooltip="Last invocation failed"></span>
			{{ else if .ViewModel.Last.State | eq "complete" }}
			<span class="uk-text-success" uk-icon="check" uk-tooltip="Last invocation completed successfully"></span>
			{{ else }}
			<span class="uk-text-primary" uk-icon="question" uk-tooltip="Last invocation state is unknown"></span>
			{{ end }}
		{{ else }}
		<span class="uk-text-primary" uk-icon="question" uk-tooltip="Job has no history"></span>
		{{ end }}
	</td>
	<td>
		<a class="uk-button uk-button-link" href="/job/{{ .ViewModel.Name | urlencode }}">{{ .ViewModel.Name }}</a>
	</td>
	<td> <!-- history -->
		{{ template "job_history_chart" .ViewModel }}
	</td>
	<td> <!-- schedule -->
	{{ if .ViewModel.Schedule }}
		{{ .ViewModel.Schedule }}
	{{ else }}
		<span>-</span>
	{{ end }}
	</td>
	<td> <!-- schedule -->
	{{ if .ViewModel.Timeout }}
		{{ .ViewModel.Timeout | duration_round_millis }}
	{{ else }}
		<span>-</span>
	{{ end }}
	</td>
	<td> <!-- next run-->
	{{ if .ViewModel.Disabled }}
		<span>-</span>
	{{ else }}
		{{ .ViewModel.NextRuntime | rfc3339 }}
	{{ end }}
	</td>
	<td> <!-- last run -->
	{{ if .ViewModel.Last }}
		{{ .ViewModel.Last.Finished | since_utc | duration_round_seconds }} ago
	{{ else }}
		<span class="none">-</span>
	{{ end }}
	</td>
	<td> <!-- job links -->
		{{ if .ViewModel.Current }}
		<a class="uk-button uk-button-small uk-button-secondary" href="/job.invocation/{{ .ViewModel.Name | urlencode }}/{{ .ViewModel.Current.ID }}" uk-icon="reply" uk-tooltip="Show the current invocation output"></a>
		{{ else if .ViewModel.Last }}
		<a class="uk-button uk-button-small uk-button-default" href="/job.invocation/{{ .ViewModel.Name | urlencode }}/{{ .ViewModel.Last.ID }}" uk-icon="reply" uk-tooltip="Show the last invocation output"></a>
		{{ else }}
		<span>-</span>
		{{ end }}

		{{ if .Ctx.State.Get "show-job-history-link" }}
		<a class="uk-button uk-button-small uk-button-default" href="/job/{{ .ViewModel.Name | urlencode }}" uk-icon="icon: history; ratio:0.75" uk-tooltip="Show job stats and history"></a>
		{{ end }}
	</td>
	<td> <!-- actions -->
	{{ if .ViewModel.Disabled }}
		<a class="uk-button uk-button-small uk-button-default" href="/job.enable/{{ .ViewModel.Name | urlencode }}" uk-icon="icon: check; ratio:0.75" uk-tooltip="Enable the job"></a>
	{{else}}
		<a class="uk-button uk-button-small uk-button-danger" href="/job.disable/{{ .ViewModel.Name | urlencode }}" uk-icon="icon: ban; ratio: 0.75" uk-tooltip="Disable the job"></a>
	{{end}}
	{{ if .ViewModel.Current }}
		<a class="uk-button uk-button-small uk-button-danger" href="/job.cancel/{{ .ViewModel.Name | urlencode }}" uk-icon="close" uk-tooltip="Cancel the running job"></a>
	{{ else }}
		<a class="uk-button uk-button-small uk-button-primary" href="/job.parameters/{{ .ViewModel.Name | urlencode }}" uk-icon="play" uk-tooltip="Force the job to run"></a>
	{{ end }}
	</td>
</tr>
<tr class="{{ .ViewModel.Name }}-extra">
	<td colspan="8"> <!-- job labels-->
	{{ range $key, $value := .ViewModel.Labels}}
		<span class="uk-label">
			<a href="/search?selector={{ $key | urlencode }}={{ $value | slugify }}">{{ $key }}={{ $value }}</a>
		</span>
	{{ end }}
	</td>
</tr>
{{ end }}
